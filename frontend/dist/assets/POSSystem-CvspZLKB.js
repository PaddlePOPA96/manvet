import{c as L,r as h,j as e,f as n,a as A,b as U,L as E}from"./index-ChC7JKR1.js";import{C as K}from"./circle-check-big-BN2ZTvY4.js";import{P as k}from"./printer-B_qgHzbW.js";import{P as B}from"./plus-CPG4z07s.js";/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=L("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);function H({products:S,packages:u,promoPriceMap:c,onSubmit:C,onSubmitPackage:b,canCreate:f}){const[i,o]=h.useState([]),[g,m]=h.useState(""),[j,P]=h.useState(""),[d,y]=h.useState(null),I=s=>{o(a=>a.find(t=>t.kind==="item"&&t.product===s.name)?a.map(t=>t.kind==="item"&&t.product===s.name?{...t,qty:t.qty+1}:t):[...a,{kind:"item",product:s.name,qty:1,price:s.price,basePrice:s.price,cost:s.cost}])},q=s=>{o(a=>a.find(t=>t.kind==="package"&&t.packageId===s.id)?a.map(t=>t.kind==="package"&&t.packageId===s.id?{...t,qty:t.qty+1}:t):[...a,{kind:"package",packageId:s.id,product:`Paket: ${s.name}`,qty:1,price:s.salePrice,basePrice:s.salePrice,cost:s.cost,components:s.components||[]}])},N=(s,a)=>{o(l=>l.map(t=>t.product===s?{...t,qty:Math.max(0,t.qty+a)}:t).filter(t=>t.qty>0))},T=s=>{const a=c&&c[s]?c[s]:null;if(!a){alert("Tidak ada harga promo aktif untuk produk ini.");return}o(l=>l.map(t=>t.product===s?{...t,price:a.eventPrice}:t))},_=s=>{const a=i.find(r=>r.product===s);if(!a)return;const l=a.price||0,t=window.prompt("Masukkan harga per unit setelah diskon:",String(l));if(!t)return;const p=parseInt(t,10);Number.isNaN(p)||p<0||o(r=>r.map(x=>x.product===s?{...x,price:p}:x))},z=()=>{if(!f){alert("Anda tidak memiliki hak untuk membuat transaksi penjualan.");return}const s=i.reduce((r,x)=>r+x.price*x.qty,0),a=parseInt(g)||0;if(i.length===0)return alert("Keranjang kosong!");if(a<s)return alert("Uang kurang!");const l=new Date().toISOString().split("T")[0],t=new Date().toLocaleString("id-ID"),p="TRX-"+Date.now().toString().slice(-6);i.forEach(r=>{r.kind==="package"?b&&b({...r,date:l}):C({type:"OUT",date:l,reseller:"POS Sales",product:r.product,condition:"SALE",quantity:r.qty,productionDate:"",price:r.price,basePrice:r.basePrice,discountPerUnit:(r.basePrice||r.price)-(r.price||0)})}),y({id:p,date:t,items:i,total:s,cash:a,change:a-s}),o([]),m("")},v=i.reduce((s,a)=>s+a.price*a.qty,0),w=(parseInt(g)||0)-v,D=S.filter(s=>s.name.toLowerCase().includes(j.toLowerCase()));return e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 h-[calc(100vh-140px)]",children:[d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100]",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl w-96 max-w-full",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-green-600 mb-2 flex justify-center",children:e.jsx(K,{size:48})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Transaksi Berhasil!"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["Kembalian:"," ",e.jsx("span",{className:"font-bold text-gray-800",children:n(d.change)})]})]}),e.jsxs("div",{id:"printable-receipt",className:"bg-white p-2 text-sm font-mono border border-gray-200 mb-4 rounded",children:[e.jsxs("div",{className:"text-center border-b border-dashed pb-2 mb-2",children:[e.jsx("h2",{className:"font-bold text-lg",children:localStorage.getItem("vet_store_settings")?JSON.parse(localStorage.getItem("vet_store_settings")).storeName:"VETPICUREAN"}),e.jsx("p",{className:"text-xs",children:localStorage.getItem("vet_store_settings")?JSON.parse(localStorage.getItem("vet_store_settings")).storeAddress:"Pet Food & Supplies"}),e.jsx("p",{className:"text-xs text-gray-500",children:d.date}),e.jsxs("p",{className:"text-xs text-gray-500",children:["#",d.id]})]}),e.jsx("div",{className:"space-y-1 mb-2 border-b border-dashed pb-2",children:d.items.map((s,a)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s.product," x",s.qty]}),e.jsx("span",{children:n(s.price*s.qty)})]},a))}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"TOTAL"}),e.jsx("span",{children:n(d.total)})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:"TUNAI"}),e.jsx("span",{children:n(d.cash)})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:"KEMBALI"}),e.jsx("span",{children:n(d.change)})]}),e.jsx("p",{className:"text-center text-[10px] text-gray-400 mt-2",children:localStorage.getItem("vet_store_settings")?JSON.parse(localStorage.getItem("vet_store_settings")).footerMessage:"Terima kasih sudah berbelanja di Vetpicurean."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>window.print(),className:"flex-1 bg-gray-800 text-white py-2 rounded-lg font-bold flex items-center justify-center gap-2",children:[e.jsx(k,{size:16})," Cetak"]}),e.jsx("button",{onClick:()=>y(null),className:"flex-1 bg-gray-200 text-gray-800 py-2 rounded-lg font-bold",children:"Tutup"})]})]})}),e.jsxs("div",{className:"flex-1 bg-white rounded-lg shadow border p-4 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 gap-2",children:[e.jsxs("h2",{className:"font-bold text-gray-700 flex items-center gap-2",children:[e.jsx(A,{size:20})," POS Kasir"]}),e.jsxs("div",{className:"relative w-56",children:[e.jsx(U,{className:"absolute left-2 top-2 text-gray-400",size:16}),e.jsx("input",{className:"pl-8 pr-3 py-1 border rounded text-sm w-full",placeholder:"Cari produk...",value:j,onChange:s=>P(s.target.value)})]})]}),u&&u.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Paket Penjualan"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(s=>e.jsxs("button",{onClick:()=>q(s),className:"border rounded-full px-3 py-1 text-xs bg-indigo-50 text-indigo-700 hover:bg-indigo-100 flex items-center gap-2",children:[e.jsx("span",{children:s.name}),e.jsx("span",{className:"font-semibold",children:n(s.salePrice||0)})]},s.id))})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 overflow-y-auto",children:D.map(s=>{const a=c&&c[s.name]?c[s.name]:null,l=a?a.eventPrice:s.price;return e.jsxs("button",{onClick:()=>I(s),className:"border rounded-lg p-2 hover:bg-teal-50 text-left flex flex-col justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.photoUrl&&e.jsx("img",{src:s.photoUrl,alt:s.name,className:"w-8 h-8 rounded object-cover border border-gray-200"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-700 font-medium",children:s.name}),s.packageInfo&&e.jsx("div",{className:"text-[10px] text-gray-500",children:s.packageInfo}),a&&e.jsxs("div",{className:"text-[10px] text-red-500",children:[a.promotionName,": ",n(l)]})]})]}),e.jsx("div",{className:"text-sm font-bold text-teal-700",children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"line-through text-gray-400 mr-1 text-xs",children:n(s.price)}),e.jsx("span",{children:n(l)})]}):e.jsx("span",{children:n(s.price)})})]},s.id||s.name)})})]}),e.jsxs("div",{className:"w-full md:w-80 bg-white rounded-lg shadow border p-4 flex flex-col",children:[e.jsxs("h3",{className:"font-bold text-gray-700 flex items-center gap-2 mb-3",children:[e.jsx(E,{size:18})," Keranjang"]}),e.jsx("div",{className:"flex-1 overflow-y-auto border rounded mb-3",children:i.length===0?e.jsx("p",{className:"text-center text-gray-400 text-sm py-4",children:"Belum ada item."}):e.jsx("ul",{className:"divide-y",children:i.map(s=>e.jsxs("li",{className:"px-3 py-2 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.product}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.qty," x ",n(s.price)]}),s.basePrice&&s.price!==s.basePrice&&e.jsxs("p",{className:"text-[10px] text-red-500",children:["Diskon dari"," ",n(s.basePrice)," per unit"]}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[e.jsx("button",{type:"button",onClick:()=>_(s.product),className:"px-2 py-0.5 border rounded text-[10px] text-teal-700 hover:bg-teal-50",children:"Diskon / Ubah harga"}),e.jsx("button",{type:"button",disabled:!c||!c[s.product],onClick:()=>T(s.product),className:"px-2 py-0.5 border rounded text-[10px] text-indigo-700 hover:bg-indigo-50 disabled:opacity-40 disabled:cursor-not-allowed",children:"Harga promo"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>N(s.product,-1),className:"p-1 rounded-full border text-gray-600 hover:bg-gray-100",children:e.jsx(R,{size:14})}),e.jsx("span",{className:"text-sm font-bold",children:s.qty}),e.jsx("button",{onClick:()=>N(s.product,1),className:"p-1 rounded-full border text-gray-600 hover:bg-gray-100",children:e.jsx(B,{size:14})})]})]},s.product))})}),e.jsxs("div",{className:"space-y-2 border-t pt-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"font-bold",children:n(v)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Tunai"}),e.jsx("input",{type:"number",className:"flex-1 border rounded px-2 py-1 text-sm",value:g,onChange:s=>m(s.target.value),placeholder:"Jumlah uang"})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Kembalian"}),e.jsx("span",{className:"font-bold text-orange-500",children:w>=0?n(w):"-"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1 mb-2",children:[5e4,1e5].map(s=>e.jsxs("button",{onClick:()=>m(s.toString()),className:"col-span-2 bg-teal-50 text-teal-700 text-xs py-1 rounded border border-teal-100 hover:bg-teal-100 font-bold",children:[s/1e3,"k"]},s))}),e.jsxs("button",{onClick:z,disabled:!f,className:"w-full bg-gray-800 text-white py-3 rounded-lg font-bold shadow hover:bg-gray-900 transition flex justify-center items-center gap-2 disabled:opacity-40 disabled:cursor-not-allowed",children:[e.jsx(k,{size:18})," Bayar & Cetak"]})]})]})]})}export{H as default};
