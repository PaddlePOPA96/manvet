import{c as P,r as h,j as e,C as S}from"./index-BeZhcdjS.js";import{T}from"./trash-2-Be8aZOHO.js";/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=P("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);function K({type:n,transactions:c,products:i,conditions:s,title:x,subtitle:o}){const r=h.useMemo(()=>{if(i&&i.length>0)return i.map(a=>a.name).filter(Boolean);const t=new Set;return c.forEach(a=>{a.type===n&&a.product&&t.add(a.product)}),Array.from(t)},[i,c,n]),[d,p]=h.useState("");h.useEffect(()=>{if(!r.length){p("");return}(!d||!r.includes(d))&&p(r[0])},[r,d]);const m=h.useMemo(()=>{if(!d)return[];const t={};return s.forEach(a=>{t[a]=0}),c.forEach(a=>{if(a.type!==n||a.product!==d)return;const y=parseInt(a.quantity,10)||0,g=a.condition||"";g&&(t[g]=(t[g]||0)+y)}),s.map(a=>({condition:a,quantity:t[a]||0}))},[s,d,c,n]),j=h.useMemo(()=>m.length>0?Math.max(...m.map(t=>t.quantity)):0,[m]);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 text-sm",children:x}),o&&e.jsx("p",{className:"text-[11px] text-gray-400 mt-0.5",children:o})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[11px] text-gray-500",children:"Produk:"}),e.jsx("select",{className:"border border-gray-300 rounded text-xs px-2 py-1 bg-white",value:d,onChange:t=>p(t.target.value),children:r.length===0?e.jsx("option",{value:"",children:"Tidak ada produk"}):r.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),!d||j===0?e.jsx("p",{className:"text-sm text-gray-400 text-center py-6",children:"Belum ada transaksi dengan kondisi untuk produk ini."}):e.jsx("div",{className:"space-y-2",children:m.map(t=>{const a=j?Math.max(4,Math.round(t.quantity/j*100)):0;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-40 text-[11px] text-gray-600",children:t.condition}),e.jsx("div",{className:"flex-1 h-4 bg-gray-100 rounded-full overflow-hidden",children:t.quantity>0&&e.jsx("div",{className:"h-4 rounded-full bg-teal-500",style:{width:`${a}%`}})}),e.jsx("div",{className:"w-10 text-right text-[11px] text-gray-700 font-semibold",children:t.quantity})]},t.condition)})})]})}function M({data:n}){if(!n||n.length===0)return null;const c=n.map(s=>{const x=s.stock||0,o=s.waste||0,r=s.quarantine||0,d=x+o+r;return{name:s.name,stock:x,waste:o,quarantine:r,total:d}}).filter(s=>s.total>0);if(c.length===0)return e.jsx("p",{className:"text-sm text-gray-400 text-center py-6",children:"Belum ada data stok untuk ditampilkan."});const i=Math.max(...c.map(s=>s.total));return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-end gap-3 overflow-x-auto pb-2",children:c.map(s=>{const x=s.total||1,r=60+(i?x/i:0)*80,d=s.stock/x*100,p=s.quarantine/x*100,m=s.waste/x*100;return e.jsxs("div",{className:"flex flex-col items-center min-w-[80px]",children:[e.jsx("div",{className:"text-[11px] text-gray-600 mb-1 text-center max-w-[90px] truncate",children:s.name}),e.jsxs("div",{className:"w-8 bg-gray-100 border border-gray-200 rounded flex flex-col justify-end overflow-hidden",style:{height:`${r}px`},children:[m>0&&e.jsx("div",{className:"bg-red-500",style:{height:`${m}%`},title:`Waste: ${s.waste}`}),p>0&&e.jsx("div",{className:"bg-amber-400",style:{height:`${p}%`},title:`Karantina: ${s.quarantine}`}),d>0&&e.jsx("div",{className:"bg-blue-500",style:{height:`${d}%`},title:`Stok Ready: ${s.stock}`})]}),e.jsxs("div",{className:"mt-1 text-[10px] text-gray-500",children:["Total: ",x]})]},s.name)})}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-[11px] text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-blue-500"}),e.jsx("span",{children:"Stok Ready"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-amber-400"}),e.jsx("span",{children:"Karantina"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-red-500"}),e.jsx("span",{children:"Waste / Rusak"})]})]})]})}function $(n){if(n.date)return n.date;if(n.timestamp)try{return new Date(n.timestamp).toISOString().split("T")[0]}catch{return null}return null}function D({transactions:n,products:c}){const i=h.useMemo(()=>{if(c&&c.length>0)return c.map(a=>a.name).filter(Boolean);const t=new Set;return n.forEach(a=>{a.product&&t.add(a.product)}),Array.from(t)},[c,n]),[s,x]=h.useState(""),[o,r]=h.useState(""),[d,p]=h.useState("");h.useEffect(()=>{if(!i.length){x("");return}(!s||!i.includes(s))&&x(i[0])},[i,s]);const m=h.useMemo(()=>{if(!s)return[];const t=n.filter(l=>l.product===s).map(l=>({...l,_dateKey:$(l)})).filter(l=>!!l._dateKey).sort((l,u)=>l._dateKey===u._dateKey?0:l._dateKey<u._dateKey?-1:1);if(t.length===0)return[];let a=0,y=0,g=0;const f={};return t.forEach(l=>{const u=parseInt(l.quantity,10)||0,v=l.condition||"",k=l.type;k==="IN"?["Barang Diterima dari Produksi","Return Barang (masih bisa digunakan)"].includes(v)?a+=u:v==="Retur Barang Rusak Karena Pengiriman"?g+=u:(y+=u,a-=u):k==="OUT"&&(["Defects / Cacat Produksi","Kadaluarsa"].includes(v)&&(y+=u),a-=u);const w=l._dateKey;f[w]={date:w,stock:Math.max(0,a),waste:Math.max(0,y),quarantine:Math.max(0,g)}}),Object.keys(f).sort().filter(l=>!(o&&l<o||d&&l>d)).map(l=>f[l])},[n,s,o,d]),j=h.useMemo(()=>m.length?Math.max(...m.map(t=>(t.stock||0)+(t.waste||0)+(t.quarantine||0))):0,[m]);return e.jsxs("div",{className:"space-y-3 border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 text-sm",children:"Pergerakan Stok per Hari (per Produk)"}),e.jsx("p",{className:"text-[11px] text-gray-400 mt-0.5",children:"Menampilkan stok ready, karantina, dan waste kumulatif per tanggal berdasarkan transaksi."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[11px]",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"Produk:"}),e.jsx("select",{className:"border border-gray-300 rounded text-xs px-2 py-1 bg-white",value:s,onChange:t=>x(t.target.value),children:i.length===0?e.jsx("option",{value:"",children:"Tidak ada produk"}):i.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"Dari:"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded text-xs px-2 py-1",value:o,onChange:t=>r(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"Sampai:"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded text-xs px-2 py-1",value:d,onChange:t=>p(t.target.value)})]})]})]}),!s||!m.length||!j?e.jsx("p",{className:"text-sm text-gray-400 text-center py-6",children:"Belum ada data pergerakan stok untuk produk dan rentang tanggal ini."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-48 flex items-end gap-3 overflow-x-auto pb-2",children:m.map(t=>{const a=(t.stock||0)+(t.waste||0)+(t.quarantine||0),g=40+(j?a/j:0)*80,f=a?t.stock/a*100:0,N=a?t.quarantine/a*100:0,b=a?t.waste/a*100:0;return e.jsxs("div",{className:"flex flex-col items-center justify-end min-w-[48px]",children:[e.jsx("div",{className:"text-[10px] text-gray-500 mb-1 font-medium",children:t.stock}),e.jsxs("div",{className:"w-6 bg-gray-100 border border-gray-200 rounded flex flex-col justify-end overflow-hidden",style:{height:`${g}px`},children:[b>0&&e.jsx("div",{className:"bg-red-500",style:{height:`${b}%`},title:`Waste: ${t.waste}`}),N>0&&e.jsx("div",{className:"bg-amber-400",style:{height:`${N}%`},title:`Karantina: ${t.quarantine}`}),f>0&&e.jsx("div",{className:"bg-blue-500",style:{height:`${f}%`},title:`Stok Ready: ${t.stock}`})]}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 text-center",children:t.date.slice(5)})]},t.date)})}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-[11px] text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-blue-500"}),e.jsx("span",{children:"Stok Ready"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-amber-400"}),e.jsx("span",{children:"Karantina"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-red-500"}),e.jsx("span",{children:"Waste / Rusak"})]})]})]})]})}function B({transactions:n,products:c,conditionChartData:i,conditionChartLimit:s,setConditionChartLimit:x,onDelete:o}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow border p-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Analisis Penjualan & Pergerakan Stok"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg border",children:e.jsx(K,{type:"OUT",transactions:n,products:c,conditions:S,title:"Kondisi Barang Keluar per Produk",subtitle:"Berdasarkan transaksi OUT (SALE/Reseller/Consignment)"})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border",children:e.jsx(D,{transactions:n,products:c})})]}),e.jsxs("div",{className:"mt-4 bg-white p-4 rounded-lg border",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 text-sm",children:"Grafik Kondisi Stok per Produk"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Snapshot stok ready, karantina, dan waste per produk."})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:"Tampilkan:"}),e.jsxs("select",{className:"border border-gray-300 rounded px-2 py-1 bg-white",value:s,onChange:r=>x(Number(r.target.value)||0),children:[e.jsx("option",{value:5,children:"Top 5"}),e.jsx("option",{value:10,children:"Top 10"}),e.jsx("option",{value:20,children:"Top 20"}),e.jsx("option",{value:0,children:"Semua produk"})]})]})]}),i.length===0?e.jsx("p",{className:"text-sm text-gray-400 text-center py-6",children:"Belum ada data stok untuk ditampilkan."}):e.jsx(M,{data:i})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-700 flex items-center gap-2",children:[e.jsx(q,{size:20})," Riwayat Transaksi"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Total: ",n.length," data"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-100 text-xs uppercase text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Tanggal"}),e.jsx("th",{className:"px-4 py-2",children:"Tipe"}),e.jsx("th",{className:"px-4 py-2",children:"Produk"}),e.jsx("th",{className:"px-4 py-2",children:"Qty"}),e.jsx("th",{className:"px-4 py-2",children:"Keterangan"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Aksi"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-4 text-gray-400",children:"Belum ada transaksi."})}):n.map(r=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-2",children:[r.date," ",e.jsx("span",{className:"text-xs text-gray-400",children:r.timestamp?new Date(r.timestamp).toLocaleTimeString("id-ID"):""})]}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${r.type==="IN"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:r.type==="IN"?"MASUK":"KELUAR"})}),e.jsx("td",{className:"px-4 py-2 font-medium",children:r.product}),e.jsx("td",{className:"px-4 py-2",children:r.quantity}),e.jsxs("td",{className:"px-4 py-2 text-xs text-gray-500",children:[r.condition," ",r.reseller&&`(${r.reseller})`]}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx("button",{onClick:()=>o(r.id),className:"text-red-400 hover:text-red-600",children:e.jsx(T,{size:14})})})]},r.id))})]})})]})]})}export{B as default};
