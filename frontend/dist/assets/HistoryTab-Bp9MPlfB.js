import{c as S,r as c,j as e,C as P,F as T}from"./index-ChC7JKR1.js";import{T as K}from"./trash-2-K0MrUoou.js";/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=S("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);function q({type:l,transactions:o,products:x,conditions:r,title:m,subtitle:p}){const i=c.useMemo(()=>{if(x&&x.length>0)return x.map(s=>s.name).filter(Boolean);const t=new Set;return o.forEach(s=>{s.type===l&&s.product&&t.add(s.product)}),Array.from(t)},[x,o,l]),[d,g]=c.useState("");c.useEffect(()=>{if(!i.length){g("");return}(!d||!i.includes(d))&&g(i[0])},[i,d]);const h=c.useMemo(()=>{if(!d)return[];const t={};return r.forEach(s=>{t[s]=0}),o.forEach(s=>{if(s.type!==l||s.product!==d)return;const b=parseInt(s.quantity,10)||0,y=s.condition||"";y&&(t[y]=(t[y]||0)+b)}),r.map(s=>({condition:s,quantity:t[s]||0}))},[r,d,o,l]),j=c.useMemo(()=>h.length>0?Math.max(...h.map(t=>t.quantity)):0,[h]);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 text-sm",children:m}),p&&e.jsx("p",{className:"text-[11px] text-gray-400 mt-0.5",children:p})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[11px] text-gray-500",children:"Produk:"}),e.jsx("select",{className:"border border-gray-300 rounded text-xs px-2 py-1 bg-white",value:d,onChange:t=>g(t.target.value),children:i.length===0?e.jsx("option",{value:"",children:"Tidak ada produk"}):i.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),!d||j===0?e.jsx("p",{className:"text-sm text-gray-400 text-center py-6",children:"Belum ada transaksi dengan kondisi untuk produk ini."}):e.jsx("div",{className:"space-y-2",children:h.map(t=>{const s=j?Math.max(4,Math.round(t.quantity/j*100)):0;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-40 text-[11px] text-gray-600",children:t.condition}),e.jsx("div",{className:"flex-1 h-4 bg-gray-100 rounded-full overflow-hidden",children:t.quantity>0&&e.jsx("div",{className:"h-4 rounded-full bg-teal-500",style:{width:`${s}%`}})}),e.jsx("div",{className:"w-10 text-right text-[11px] text-gray-700 font-semibold",children:t.quantity})]},t.condition)})})]})}function D({data:l}){if(!l||l.length===0)return null;const o=l.map(r=>{const m=r.stock||0,p=r.waste||0,i=r.quarantine||0,d=m+p+i;return{name:r.name,stock:m,waste:p,quarantine:i,total:d}}).filter(r=>r.total>0);if(o.length===0)return e.jsx("p",{className:"text-sm text-gray-400 text-center py-6",children:"Belum ada data stok untuk ditampilkan."});const x=Math.max(...o.map(r=>r.total));return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-end gap-3 overflow-x-auto pb-2",children:o.map(r=>{const m=r.total||1,i=60+(x?m/x:0)*80,d=r.stock/m*100,g=r.quarantine/m*100,h=r.waste/m*100;return e.jsxs("div",{className:"flex flex-col items-center min-w-[80px]",children:[e.jsx("div",{className:"text-[11px] text-gray-600 mb-1 text-center max-w-[90px] truncate",children:r.name}),e.jsxs("div",{className:"w-8 bg-gray-100 border border-gray-200 rounded flex flex-col justify-end overflow-hidden",style:{height:`${i}px`},children:[h>0&&e.jsx("div",{className:"bg-red-500",style:{height:`${h}%`},title:`Waste: ${r.waste}`}),g>0&&e.jsx("div",{className:"bg-amber-400",style:{height:`${g}%`},title:`Karantina: ${r.quarantine}`}),d>0&&e.jsx("div",{className:"bg-blue-500",style:{height:`${d}%`},title:`Stok Ready: ${r.stock}`})]}),e.jsxs("div",{className:"mt-1 text-[10px] text-gray-500",children:["Total: ",m]})]},r.name)})}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-[11px] text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-blue-500"}),e.jsx("span",{children:"Stok Ready"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-amber-400"}),e.jsx("span",{children:"Karantina"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-red-500"}),e.jsx("span",{children:"Waste / Rusak"})]})]})]})}function $(l){if(l.date)return l.date;if(l.timestamp)try{return new Date(l.timestamp).toISOString().split("T")[0]}catch{return null}return null}function A({transactions:l,products:o}){const x=c.useMemo(()=>{if(o&&o.length>0)return o.map(s=>s.name).filter(Boolean);const t=new Set;return l.forEach(s=>{s.product&&t.add(s.product)}),Array.from(t)},[o,l]),[r,m]=c.useState(""),[p,i]=c.useState(""),[d,g]=c.useState("");c.useEffect(()=>{if(!x.length){m("");return}(!r||!x.includes(r))&&m(x[0])},[x,r]);const h=c.useMemo(()=>{if(!r)return[];const t=l.filter(n=>n.product===r).map(n=>({...n,_dateKey:$(n)})).filter(n=>!!n._dateKey).sort((n,f)=>n._dateKey===f._dateKey?0:n._dateKey<f._dateKey?-1:1);if(t.length===0)return[];let s=0,b=0,y=0;const N={};return t.forEach(n=>{const f=parseInt(n.quantity,10)||0,v=n.condition||"",k=n.type;k==="MASUK"?["Barang Diterima dari Produksi","Return Barang (masih bisa digunakan)"].includes(v)?s+=f:v==="Retur Barang Rusak Karena Pengiriman"?y+=f:(b+=f,s-=f):k==="KELUAR"&&(["Defects / Cacat Produksi","Kadaluarsa"].includes(v)&&(b+=f),s-=f);const w=n._dateKey;N[w]={date:w,stock:Math.max(0,s),waste:Math.max(0,b),quarantine:Math.max(0,y)}}),Object.keys(N).sort().filter(n=>!(p&&n<p||d&&n>d)).map(n=>N[n])},[l,r,p,d]),j=c.useMemo(()=>h.length?Math.max(...h.map(t=>(t.stock||0)+(t.waste||0)+(t.quarantine||0))):0,[h]);return e.jsxs("div",{className:"space-y-3 border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 text-sm",children:"Pergerakan Stok per Hari (per Produk)"}),e.jsx("p",{className:"text-[11px] text-gray-400 mt-0.5",children:"Menampilkan stok ready, karantina, dan waste kumulatif per tanggal berdasarkan transaksi."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[11px]",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"Produk:"}),e.jsx("select",{className:"border border-gray-300 rounded text-xs px-2 py-1 bg-white",value:r,onChange:t=>m(t.target.value),children:x.length===0?e.jsx("option",{value:"",children:"Tidak ada produk"}):x.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"Dari:"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded text-xs px-2 py-1",value:p,onChange:t=>i(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"Sampai:"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded text-xs px-2 py-1",value:d,onChange:t=>g(t.target.value)})]})]})]}),!r||!h.length||!j?e.jsx("p",{className:"text-sm text-gray-400 text-center py-6",children:"Belum ada data pergerakan stok untuk produk dan rentang tanggal ini."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-48 flex items-end gap-3 overflow-x-auto pb-2",children:h.map(t=>{const s=(t.stock||0)+(t.waste||0)+(t.quarantine||0),y=40+(j?s/j:0)*80,N=s?t.stock/s*100:0,a=s?t.quarantine/s*100:0,u=s?t.waste/s*100:0;return e.jsxs("div",{className:"flex flex-col items-center justify-end min-w-[48px]",children:[e.jsx("div",{className:"text-[10px] text-gray-500 mb-1 font-medium",children:t.stock}),e.jsxs("div",{className:"w-6 bg-gray-100 border border-gray-200 rounded flex flex-col justify-end overflow-hidden",style:{height:`${y}px`},children:[u>0&&e.jsx("div",{className:"bg-red-500",style:{height:`${u}%`},title:`Waste: ${t.waste}`}),a>0&&e.jsx("div",{className:"bg-amber-400",style:{height:`${a}%`},title:`Karantina: ${t.quarantine}`}),N>0&&e.jsx("div",{className:"bg-blue-500",style:{height:`${N}%`},title:`Stok Ready: ${t.stock}`})]}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 text-center",children:t.date.slice(5)})]},t.date)})}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-[11px] text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-blue-500"}),e.jsx("span",{children:"Stok Ready"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-amber-400"}),e.jsx("span",{children:"Karantina"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-red-500"}),e.jsx("span",{children:"Waste / Rusak"})]})]})]})]})}function F({transactions:l,products:o,conditionChartData:x,conditionChartLimit:r,setConditionChartLimit:m,onDelete:p}){const[i,d]=c.useState("ALL"),[g,h]=c.useState("ALL"),[j,t]=c.useState(""),[s,b]=c.useState(""),y=c.useMemo(()=>{let a=[...l];return i!=="ALL"&&(a=a.filter(u=>u.type===i)),g!=="ALL"&&(a=a.filter(u=>u.product===g)),j&&(a=a.filter(u=>u.date>=j)),s&&(a=a.filter(u=>u.date<=s)),a.sort((u,n)=>{const f=new Date(u.timestamp||u.date).getTime()||0;return(new Date(n.timestamp||n.date).getTime()||0)-f}),a},[l,i,g,j,s]),N=c.useMemo(()=>{const a=new Set(l.map(u=>u.product));return Array.from(a).sort()},[l]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow border p-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Analisis Penjualan & Pergerakan Stok"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg border",children:e.jsx(q,{type:"KELUAR",transactions:l,products:o,conditions:P,title:"Kondisi Barang Keluar per Produk",subtitle:"Berdasarkan transaksi OUT (SALE/Reseller/Consignment)"})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border",children:e.jsx(A,{transactions:l,products:o})})]}),e.jsxs("div",{className:"mt-4 bg-white p-4 rounded-lg border",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 text-sm",children:"Grafik Kondisi Stok per Produk"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Snapshot stok ready, karantina, dan waste per produk."})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:"Tampilkan:"}),e.jsxs("select",{className:"border border-gray-300 rounded px-2 py-1 bg-white",value:r,onChange:a=>m(Number(a.target.value)||0),children:[e.jsx("option",{value:5,children:"Top 5"}),e.jsx("option",{value:10,children:"Top 10"}),e.jsx("option",{value:20,children:"Top 20"}),e.jsx("option",{value:0,children:"Semua produk"})]})]})]}),x.length===0?e.jsx("p",{className:"text-sm text-gray-400 text-center py-6",children:"Belum ada data stok untuk ditampilkan."}):e.jsx(D,{data:x})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-700 flex items-center gap-2",children:[e.jsx(M,{size:20})," Riwayat Transaksi"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Menampilkan: ",y.length," / ",l.length," data"]})]}),e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(T,{size:16,className:"text-gray-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Filter"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Tipe"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2 text-sm bg-white",value:i,onChange:a=>d(a.target.value),children:[e.jsx("option",{value:"ALL",children:"Semua"}),e.jsx("option",{value:"MASUK",children:"Masuk"}),e.jsx("option",{value:"KELUAR",children:"Keluar"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Produk"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2 text-sm bg-white",value:g,onChange:a=>h(a.target.value),children:[e.jsx("option",{value:"ALL",children:"Semua Produk"}),N.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Dari Tanggal"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2 text-sm",value:j,onChange:a=>t(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Sampai Tanggal"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2 text-sm",value:s,onChange:a=>b(a.target.value)})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-100 text-xs uppercase text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Tanggal"}),e.jsx("th",{className:"px-4 py-2",children:"Tipe"}),e.jsx("th",{className:"px-4 py-2",children:"Produk"}),e.jsx("th",{className:"px-4 py-2",children:"Qty"}),e.jsx("th",{className:"px-4 py-2",children:"Keterangan"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Aksi"})]})}),e.jsx("tbody",{children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-4 text-gray-400",children:l.length===0?"Belum ada transaksi.":"Tidak ada transaksi yang sesuai dengan filter."})}):y.map(a=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-2",children:[a.date?a.date.substring(0,10):"-"," ",e.jsx("span",{className:"text-xs text-gray-400",children:a.timestamp||a.date?new Date(a.timestamp||a.date).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${a.type==="MASUK"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:a.type})}),e.jsx("td",{className:"px-4 py-2 font-medium",children:a.product}),e.jsx("td",{className:"px-4 py-2",children:a.quantity}),e.jsxs("td",{className:"px-4 py-2 text-xs text-gray-500",children:[a.condition," ",a.reseller&&`(${a.reseller})`]}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx("button",{onClick:()=>p(a.id),className:"text-red-400 hover:text-red-600",children:e.jsx(K,{size:14})})})]},`${a.id}-${a.type}-${Math.random()}`))})]})})]})]})}export{F as default};
